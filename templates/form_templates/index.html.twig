{% extends '/base.html.twig' %}

{% block title %}Список форм{% endblock %}

{% block body %}
    <div class="min-h-screen bg-gray-100 dark:bg-gray-900 py-6 sm:py-10 px-2 sm:px-4">
        <div class="max-w-6xl mx-auto bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-4 sm:p-8">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                <h1 class="text-2xl sm:text-3xl font-semibold text-gray-900 dark:text-white">Список форм</h1>
                <a href="{{ path('form_template_new') }}"
                   class="bg-purple-600 text-white px-5 py-2 rounded-lg text-sm font-medium hover:bg-purple-700 dark:hover:bg-purple-500 transition">
                    + Создать форму
                </a>
            </div>

            {% if forms is empty %}
                <div class="text-center text-gray-500 dark:text-gray-400 py-12">Формы не найдены.</div>
            {% else %}
                <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
                    {% for form in forms %}
                        <div
                            class="bg-white dark:bg-gray-700 rounded-xl shadow p-5 flex flex-col justify-between h-full">
                            <div>
                                <h2 class="text-lg font-bold text-gray-900 dark:text-white mb-1">{{ form.title }}</h2>
                                <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">
                                    {{ form.description|default('—') }}
                                </p>

                                <div class="text-xs text-gray-500 dark:text-gray-400 mb-1">
                                    <span>Создано:</span>
                                    {{ form.createdAt ? form.createdAt|date('d.m.Y') : '—' }}
                                </div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">
                                    <span>Обновлено:</span>
                                    {{ form.updatedAt ? form.updatedAt|date('d.m.Y H:i') : '—' }}
                                </div>
                                {% if is_granted('ROLE_SUPER_ADMIN') %}
                                    <div class="text-xs text-gray-500 dark:text-gray-400">
                                        <span>Автор:</span>
                                        {{ form.owner.email }}
                                    </div>
                                {% endif %}
                            </div>

                            <div class="mt-4 flex flex-wrap gap-3">
                                <a href="{{ path('form_template_view', { id: form.id }) }}"
                                   class="text-sm text-purple-600 dark:text-purple-400 hover:underline">Открыть</a>

                                {% if app.user == form.owner or is_granted('ROLE_SUPER_ADMIN') %}
                                    <a href="{{ path('form_template_edit', { id: form.id }) }}"
                                       class="text-sm text-blue-600 dark:text-blue-400 hover:underline">Редактировать</a>

                                    <form method="post"
                                          action="{{ path('form_template_delete', { id: form.id }) }}"
                                          class="inline"
                                          onsubmit="return confirm('Вы уверены, что хотите удалить эту форму?');">
                                        <input type="hidden" name="_token"
                                               value="{{ csrf_token('delete_form_' ~ form.id) }}">
                                        <button type="submit"
                                                class="text-sm text-red-600 dark:text-red-400 hover:underline bg-transparent border-none p-0 m-0"
                                                style="cursor:pointer;">Удалить
                                        </button>
                                    </form>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}
